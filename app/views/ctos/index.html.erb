<script type="text/javascript">
    function MapData (addresses,titles,descriptions, lats,lngs){
        this.addresses = addresses;
        this.titles = titles;
        this.descriptions = descriptions;
        this.lats = lats;
        this.lngs = lngs;
    }
    var addresses = [];
    var titles = [];
    var descriptions = [];
    var lats = [];
    var lngs = [];

    <% @ctos.each do |cto| %>
        addresses.push("<%=cto.address%>");
        titles.push("<%=cto.name%>");
        titles.push("<%=cto.description%>");
        lats.push("<%=cto.latitude%>");
        lngs.push("<%=cto.longitude%>");
    <% end %>


     mapData = new MapData(addresses, titles, descriptions, lats, lngs);
    //$(this).showRoutes(false,mapData);
</script>


<!--Form should perform a search according to distance and schedule.Let it be until schedule will not be implemented.TODO refactor search -->

   <!--Let's build custom search form -->
<div style="padding:5px">
  <%= form_tag({:controller=>'ctos', :action=>'index',:method=> 'get'},{:class =>'navbar-form navbar-left',:role => 'search'}) do%>
    <div class="form-group">

        <span>
          <%= label_tag(:requestDate, "Дата запису") %>
          <%= text_field_tag(:requestDate)%>
         </span>

        <span>
          <%= label_tag(:requestTime, "Дата запису") %>
          <!--Let's iterate over time to create time options -->
          <%= select_tag(:requestTime, options_for_select(@timeStorage)) %>
        </span>

      </div>
       <span><%= submit_tag("Search", :class=>"btn btn-default") %></span>
    <% end %>
</div>


<div class="container" id="main" style="float:left">
    <% @ctos.each_slice(3) do |ctoChunk|%>
         <div class="row" style="margin:0px;height:200px">
             <% ctoChunk.each do |cto| %>
              <div class="col-md-4">
                <div class="panel-info"><span style="font-weight:bold">Назва:</span><span><%= cto.name %></span></div>
                <div class="panel-body"><span style="font-weight:bold">Опис:</span><div><%= cto.description.truncate(50) %></div>
                  <div style="font-weight:bold">Адреса:</span><span><%= cto.address %></div>
                  <div style="font-weight:bold">Контакти:</div><div><%= cto.contacts %></div>
                  <div style="clear:both;width:100%;text-align:right">
                    <span style="margin-right:1px;width:32%;font-size:10px;text-align:right"><%= link_to 'Переглянути розклад', cto_path(cto), class: 'btn btn-default', style: 'font-size:10px' %></span>
                  </div>
                </div>
         </div>
             <% end %>

         </div>
      <hr>
     <% end %>
  <%= paginate @ctos %>
</div>




  <div id="route_map" style="display:block;position:absolute">
    <div id="map_canvas" style="width:400px;height:400px"></div>
  </div>

<script type="text/javascript">
    $("#requestDate" ).datepicker();
    $("#requestDate" ).datepicker( "option", "dateFormat","dd-mm-yy" );
</script>


